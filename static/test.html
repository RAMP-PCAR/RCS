<!DOCTYPE html>
<html>
<head>
    <title>JSON Store Test</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="form-group col-md-6">
            <label>Small Key</label>
            <input class="form-control" type="text" id="smallkey" value="0" />
        </div>
        <div class="form-group col-md-6">
            <label>Get Method Language</label>
            <br />
            <div class="btn-group" data-toggle="buttons">
                <label class="btn btn-default active">
                    <input type="radio" name="lang" id="lang-en" value="en" checked /> English
                </label>
                <label class="btn btn-default">
                    <input type="radio" name="lang" id="lang-fr" value="fr" /> French
                </label>
            </div>
        </div>
    </div>

    <div class="row"><div class="form-group col-md-12">
        <textarea id="data" rows=7 class="form-control"></textarea>
    </div></div>

    <div class="row"><div class="form-group col-md-12">
        <button class="btn" id='puttest'>PUT</button>
        <button class="btn" id='gettest'>GET</button>
        <button class="btn" id='deltest'>DELETE</button>
        <input type="button" class="btn sampledata" value="Unique with Default"
               data-url="http://devmap.on.ec.gc.ca/ArcGIS/rest/services/ECNY/MapServer/0" />
        <input type="button" class="btn sampledata" value="Class Breaks"
               data-url="http://devmap.on.ec.gc.ca/ArcGIS/rest/services/ClassBreaks/MapServer/0" />
        <input type="button" class="btn sampledata" value="JOSM Unique"
               data-url="http://sncr01wbingsdv1.ncr.int.ec.gc.ca/arcgis/rest/services/JOSM/Oilsands/MapServer/0" />
        <input type="button" class="btn samplejson" value="WMS" data-obj="sampleWMS" />
        <input type="button" class="btn samplejson" value="Full WMS" data-obj="fullWMS" />
        <input type="button" class="btn samplejson" value="Feature" data-obj="sampleFeature" />
    </div></div>

    <div class="row"><div id="log" class="form-group col-md-12">
    </div></div>

</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script>
    var sampleWMS = {
            version: "1.0.0",
            payload_type: "wms",
            en: { service_url: "http://wms.ess-ws.nrcan.gc.ca/wms/toporama_en", layer: "limits" },
            fr: { service_url: "http://wms.ess-ws.nrcan.gc.ca/wms/toporama_en", layer: "limits" },
        },
        sampleFeature = {
            version: "1.0.0",
            payload_type: "feature",
            en: { service_url: "http://sncr01wbingsdv1.ncr.int.ec.gc.ca/arcgis/rest/services/RAMP/RAMP_ResearchCentres/MapServer/0" },
            fr: { service_url: "http://sncr01wbingsdv1.ncr.int.ec.gc.ca/arcgis/rest/services/RAMP/RAMP_ResearchCentres/MapServer/0" },
        },
        fullWMS = {
            version: "1.0.0",
            payload_type: "wms",
            en: { service_url: "http://sedac.ciesin.org/geoserver/ows", layer: "aglands:aglands-pastures-2000", legend_format: "image/jpeg", feature_info_type: "text/plain" },
            fr: { service_url: "http://sedac.ciesin.org/geoserver/ows", layer: "aglands:aglands-pastures-2000" },
        };


    function log_info(s) {
        console.log(s);
        $('#log').append('<p class="bg-info">'+s+'</p>');
    }
    function log_err(s) {
        console.log(s);
        $('#log').append('<p class="bg-danger">'+s+'</p>');
    }
    $(document).ready(function () {
        $('#data').val(JSON.stringify(sampleFeature));

        $('#puttest').click( function() {
            $.ajax({
                type: "PUT",
                contentType: "application/json; charset=utf-8",
                url: '/register/' + $('#smallkey').val(),
                data: $('#data').val(),
                dataType: "text",
            }).done(function (data, status, xhr) {
                log_info('put done '+xhr.status);
                log_info(data);
            }).fail(function (err) {
                log_err('put failed '+err.status);
                log_err(err.responseText);
                console.log(err);
            });

        });
        $('#deltest').click( function() {
            $.ajax({
                type: "DELETE",
                url: '/register/' + $('#smallkey').val(),
                dataType: "text",
            }).done(function (data, status, xhr) {
                log_info('del done '+xhr.status);
            }).fail(function (err) {
                log_err('del failed '+err.status);
                console.log(err);
            });

        });

        $('.sampledata').click( function(e) {
            var sample = { version: "1.0.0", payload_type: 'feature', en: {}, fr: {} }
            sample.en.service_url = $(e.target).data('url');
            sample.fr.service_url = $(e.target).data('url');
            $('#data').val(JSON.stringify(sample));
        });

        $('.samplejson').click(function (e) {
            $('#data').val(JSON.stringify(window[$(e.target).data('obj')]));
        });

        $('#gettest').click( function() {
            var u = '/doc/' + $('[name=lang]:checked').val() + '/' + $('#smallkey').val();
            log_info('GET URL: '+u);
            $.ajax({
                type: "GET",
                url: u,
                dataType: "json",
            }).done(function (data) {
                log_info('get done');
                log_info(JSON.stringify(data));
                $('#data').val(JSON.stringify(data));
            }).fail(function (err) {
                log_err('get failed '+err.status);
                log_err(JSON.stringify(err));
                console.log(err);
            });
        });
    });
</script>

</body>
</html>
